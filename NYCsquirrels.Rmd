---
title: "NYCsquirrels"
author: "Jeff Grayum"
date: "8/29/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Loading libraries.
```{r}
library(tidyverse)
library(tidytuesdayR)
library(scales)
library(ggthemes)
```

Loading datasets.   
```{r}
nyc_squirrels <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-10-29/nyc_squirrels.csv")

nyc_squirrels %>%
  view()
```

Doing some stuff before watching the screencast.
```{r}
nyc_squirrels %>%
  count(unique_squirrel_id, sort = TRUE)

nyc_squirrels %>%
  filter(unique_squirrel_id %in% "1F-AM-1010-04") %>%
  view()

nyc_squirrels %>%
  count(highlight_fur_color, sort = TRUE)

nyc_squirrels %>%
  filter(!is.na(primary_fur_color),
         !is.na(highlight_fur_color)) %>%
  mutate(highlight_fur_color = fct_lump(highlight_fur_color, 4)) %>%
  count(primary_fur_color, highlight_fur_color) %>%
  mutate(primary_fur_color = fct_reorder(primary_fur_color, n, sum)) %>%
  ggplot(aes(n, primary_fur_color, fill = highlight_fur_color)) +
  geom_col() +
  scale_color_discrete() +
  labs(x = " ",
       y = "Primary fur color",
       fill = "Highlight fur color",
       title = "Colors of NYC squirrels") +
  theme_hc()

nyc_squirrels %>%
  filter(!is.na(primary_fur_color),
         !is.na(age),
         age != "?") %>%
  count(primary_fur_color, age) %>%
  mutate(primary_fur_color = fct_reorder(primary_fur_color, n, sum)) %>%
  ggplot(aes(n, primary_fur_color, fill = age)) +
  geom_col() +
  scale_color_discrete() +
  labs(x = " ",
       y = "Primary fur color",
       fill = "Age",
       title = "Primary colors of NYC squirrels") +
  theme_hc()

nyc_squirrels %>%
  filter(!is.na(specific_location)) %>%
  count(specific_location, sort = TRUE) %>%
  head(7) %>%
  mutate(specific_location = fct_reorder(specific_location, n)) %>%
  ggplot(aes(n, specific_location, fill = specific_location)) +
  geom_col() +
  labs(x = "",
       y = "Location seen",
       title = "Where we be seeing these squirrels?") +
  theme_hc() +
  theme(legend.position = "none")
```


Okidokie. Screencast time.
```{r}
nyc_squirrels %>%
  ggplot(aes(long, lat)) +
  geom_point() +
  theme_map()

by_hectare <- nyc_squirrels %>%
  filter(!is.na(primary_fur_color)) %>%
  group_by(hectare) %>%
  summarize(long = mean(long),
            lat = mean(lat),
            pct_gray = mean(primary_fur_color == "Gray", na.rm = TRUE),
            n = n()) 

by_hectare %>%
  ggplot(aes(long, lat, size = n)) +
  geom_point() +
  theme_map() +
  theme(legend.position = "right") +
  labs(title = "Squirrels in Central Park",
       size = "# squirrels/hectare")

nyc_squirrels %>%
  count(color_notes, sort = TRUE)

nyc_squirrels %>%
  count(primary_fur_color, sort = TRUE)

nyc_squirrels %>%
  count(primary_fur_color, highlight_fur_color, sort = TRUE)

by_hectare %>%
  filter(n >= 10) %>%
  ggplot(aes(long, lat, size = n, color = pct_gray)) +
  geom_point() +
  theme_map() +
  theme(legend.position = "right")

by_hectare %>%
  filter(n >= 10) %>%
  ggplot(aes(lat, pct_gray)) +
  geom_point() +
  geom_smooth() +
  labs(x = "Latitude",
       y = "% gray (primary fur color)",
       title = "How does primary color change with latitude?",
       subtitle = "Looking at squirells in Central Park") +
  theme_tufte()

by_hectare %>%
  filter(n >= 10) %>%
  ggplot(aes(long, pct_gray)) +
  geom_point() +
  geom_smooth() +
  labs(x = "Longitude",
       y = "% gray (primary fur color)",
       title = "How does primary color change with longitude?",
       subtitle = "Looking at squirells in Central Park") +
  theme_tufte()

by_hectare %>%
  mutate(n_gray = round(pct_gray * n)) %>%
  glm(cbind(n_gray, n - n_gray) ~ lat, data = ., family = "binomial") %>%
  summary()

#Positive estimate (lat 23.058), with sig pvalue (3.81e -06), Squirrels more likely to be gray as you move north!

by_hectare %>%
  mutate(n_gray = round(pct_gray * n)) %>%
  glm(cbind(n_gray, n - n_gray) ~ long, data = ., family = "binomial") %>%
  summary()

#It seems like squirrels more likely to be gray as long increases, as well.


#Lets look at behavior.
nyc_squirrels %>%
  count(approaches, sort = TRUE)

nyc_squirrels %>%
  count(indifferent, sort = TRUE)

nyc_squirrels %>%
  count(runs_from, sort = TRUE)

nyc_squirrels %>%
  count(approaches, indifferent, runs_from, sort = TRUE)

```

